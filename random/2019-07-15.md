# 2019-07-15

|Time (UTC)|Icon|Name|Message|
|---|---|---|---|
|15:43|![](https://avatars.slack-edge.com/2020-01-22/918424979847_0035b70d5fcd5cec902e_72.png)|小形克宏|引き続き、今度の定例会に向けてVivliostyleに挑戦中……ですが、なかなかうまくいかない。途中を端折ると伝わらないので、長くなりますが最初から説明させてください。<br><br>ここでの目的はマンガのシナリオをVivliostyleで組むことです。なお、組み方向は縦とします。<br><br>*《問題Ⓐ：HTML+CSSでタブが表現できない問題》*<br><br>①あらかじめInDesignで試行錯誤し、以下のようにすればシナリオ風に組めることを確認、これをHTML+CSSで表現しようと考えました。<br>• 役名だけボールドにする<br>• 役名とセリフはタブで区切る〈問題Ⓐの伏線〉<br>• 1行目インデント：-Nミリ／左上インデント：Nミリ<br><https://www.dropbox.com/s/8i3bxordaqftubt/blogdramafig01.png?dl=0><br>②テキストをマークダウンにします。ここでセリフ毎の改行ができないという問題が発生、これは空行&lt;br&gt;を入れることで解決することがわかりました〈問題Ⓑの伏線〉<br><https://jagat-xpub.slack.com/archives/CGT1SGHPF/p1562516881003900><br><br>③空行を入れるようMDファイルを修正し、それをHTMLに変換します。ところがHTMLへの書き出しの過程で、タブが半角スペース4つに置き換えられていることが判明。そこでテキストエディタでタブに置換。さらにタブを正確に表示するよう、セリフ部分だけ "white-space: pre;" を指定することにしました。そのファイルがこちら <https://www.dropbox.com/s/i76d0mau8ktvuls/20190111_%E6%AD%BB%E5%88%91%E3%82%B3%E3%83%9F%E3%83%83%E3%82%AF%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%EF%BC%91_20190715-4.html?dl=0><br><br><br>④このファイルを村上さんのアドバイス<br><https://vivliostyle.slack.com/archives/CJRP7PK6K/p1561526376012500?thread_ts=1561084804.004600&amp;cid=CJRP7PK6K><br>に従い、Vivliostyleで読み込ませました。ところがwhite-spaceを指定したことにより、行が長くなった場合でも折り返されない（そういう仕様である）ことが発覚。<br><br>【190715-0001.png】<br><br>《問題Ⓐの解説》役名とセリフの区切りにタブを使うことで、役名の字数が異なる場合でもセリフの開始位置を揃えられます。つまりタブを使う必要性があるのです。他方、white-spaceの振る舞い以前の問題として、タブの幅は環境に依存するのでHTML+CSSで使うこと自体に無理があると言えます。今のところ代替の方法を思いつきません。<br><br><br>*《問題Ⓑ：空行には1行目インデントが適用されない問題》*<br><br>⑤仕方ないので問題Ⓐはそのままにして作業続行。Vivliostyleでインデントの表現に挑戦します。調べたところ、これはいわゆる「ぶら下げインデント」というものなのですね。p要素に対し、以下のように指定すればよさそうです。<br><br>p {<br>      margin-left: 5em; /* ブロック全体を 5em 右（縦の場合は下）に */<br>      text-indent: -5em; /* 先頭行のみ 5em 左（縦の場合は上）に */<br>}<br>/* 5emは役名の最大文字数が5文字であることによる */<br><br>縦組やフォントなども、サンプルで公開されている「高瀬舟」のCSS<br><https://github.com/vivliostyle/vivliostyle.js/blob/gh-pages/samples/variable-page-size/ja-vertical/Takasebune/style.css><br>を参考にして、「CSS Details」欄にペーストして「Apply」をクリック。<br><br>⑥ところが、段落2行目がインデントされてしまい、行頭が揃わない問題が発覚。<br><br>【190716-0001.png】<br><br>よく考えればこれも当然のことで、段落2行目と書きましたが、単に&lt;br&gt;で区切っただけの同じ段落内なので、これが指定どおりの振る舞いなのです。<br><br>対処方法としては、&lt;br&gt;は使わないことにし、1つのセリフを1つのp要素にするようHTMLを修正しようと考えています。ちょっと大変だけど仕方ないか……。<br><br>こんな感じですが、「もっとこうするといいよ」とか「それ間違ってるよ」などありましたらお願いいたします。<br>https://jagat-xpub.slack.com/files/UGS0HG7H6/FL8FSUDC1/190715-0001.png<br>https://jagat-xpub.slack.com/files/UGS0HG7H6/FLEC7GQ84/190716-0001.png|
